sudo: required
dist: trusty
language: generic
env:
  global:
    - SINGULARITY_IMAGE=singularity-rstudio.simg
    - VERSION=2.5.0
  matrix:
    - SPEC=Singularity
    - SPEC=Singularity.1.2.1237
    - SPEC=Singularity.1.2.1256
before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -y libarchive-dev squashfs-tools wget
install:
  - wget https://github.com/sylabs/singularity/releases/download/$VERSION/singularity-$VERSION.tar.gz
  - tar xvf singularity-$VERSION.tar.gz
  - cd singularity-$VERSION
  - ./configure --prefix=/usr/local
  - make && sudo make install 
  - cd ..
before_script:
  - sudo singularity build $SINGULARITY_IMAGE $SPEC
  - chmod +x run_tests.sh
script: ./run_tests.sh
notifications:
  email:
    on_success: never
    on_failure: always
  webhooks:
    urls: 
      - https://api.github.com/repos/tpall/singularity-r/deployments
    on_success: always
    on_failure: never
